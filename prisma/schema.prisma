// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           Int         @id @default(autoincrement())
  firstName    String
  lastName     String
  userName     String      @unique
  avatar       String     //avatar
  email        String      @unique
  phoneNumber  String      @unique
  password     String
  savedTemplates Template[] // One-to-many relationship with templates
  blogPosts    BlogPost[]  // One-to-many relationship with blog posts
  comments     Comment[]   // One-to-many relationship with comments
  abuseReports AbuseReport[] // One-to-many relationship with abuse reports
  role         Role        @default(USER) // User or Admin
}

// enum defines predefined inputs of the role attribute above: USER, ADMIN
enum Role {
  USER
  ADMIN
}

enum templateTag {
  JavaScript
  Java
  C
  CPlus
  Python
  Arrays
  Strings
  Hash
  BitManipulation
  DP
  Stack
  Queue
  LinkedList
  Sorting
  Greedy
  Tree
  BFS
  DFS
  Database
  Heap
  TwoPointer
  SlidingWindow
  Recursive
  Shell
}

enum blogTag {
  JavaScript
  Java
  C
  CPlus
  Python
  Easy
  Medium
  Hard
  Arrays
  Strings
  Hash
  BitManipulation
  DP
  Stack
  Queue
  LinkedList
  Sorting
  Greedy
  Tree
  BFS
  DFS
  Database
  Heap
  TwoPointer
  SlidingWindow
  Recursive
  Shell
}

model Template {
  id          Int    @id @default(autoincrement())
  ownerId     Int     @unique
  owner       User   @relation(fields:[ownerId], references:[id])
  title       String
  explanation      String
  tags        templateTag
  code        Code
  codeId      Int
  isForked    Boolean    @default(false)
  parentTemplateId    Int?   // optional if not forked. 
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  blogPosts      BlogPost[]  
}

model Code {
  id          Int     @id @default(autoincrement())
  parentTemplateId   Int @unique
  parentTemplate    Template    @relation(fields:[parentTemplateId], references:[id])
  language     String
  input     String?
  output     String?
  error      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

model BlogPost {
 id          Int     @id @default(autoincrement())
 authorId    Int      @unique
 author      User    @relation(fields: [authorId], references: [id])
 title       String
 description      String
 tags        blogTag
 templateId   Int   
 templates   Template?    @relation(fields: [templateId], references: [id])
 comments    Comment[]
 upvoteOrDownvote   Int  @default(0)
 abuseReports  AbuseReport[]
 createdAt      DateTime     @default(now())
 updatedAt      DateTime     @updatedAt
}

model Comment {
  id         Int     @id @default(autoincrement())
authorId    Int      @unique
 author      User    @relation(fields: [authorId], references: [id])
 content     String
 blogId    Int      @unique
  blog      BlogPost    @relation(fields:[blogId], references:[id])
 upvoteOrDownvote   Int  @default(0)
//  replies    Comment[]
//  repliedToComment Comment? //comment that this comment replied to - optional - doesn't have to be a replied comment
 abuseReports    AbuseReport[]
 createdAt      DateTime     @default(now())
}

model AbuseReport {
  id         Int     @id @default(autoincrement())
  authorId    Int     @unique
  author      User    @relation(fields:[authorId], references:[id])
 description     String
 createdAt      DateTime     @default(now())
 blogId    Int    @unique
  blog      BlogPost?    @relation(fields:[blogId], references:[id])
 commentId    Int     @unique
  comment      Comment?    @relation(fields:[commentId], references:[id])
}

